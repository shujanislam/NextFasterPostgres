{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 44, "column": 0}, "map": {"version":3,"sources":["file:///home/ayan/Programming/NextFasterPostgres/src/app/%28category-sidebar%29/products/%5Bcategory%5D/page.tsx"],"sourcesContent":["import Image from \"next/image\";\nimport { Link } from \"@/components/ui/link\";\nimport { notFound } from \"next/navigation\";\nimport pool from \"@/db\";\nimport { getCategoryProductCount } from \"@/lib/queries\";\n\nexport default async function Page(props: { params: { category: string } }) {\n  const { category } = await props.params;\n  const urlDecoded = decodeURIComponent(category);\n\n  // Fetch category + subcollections + subcategories\n  const { rows } = await pool.query(\n    `\n    SELECT\n      c.slug AS category_slug,\n      c.name AS category_name,\n      sc.id AS subcollection_id,\n      sc.name AS subcollection_name,\n      s.slug AS subcategory_slug,\n      s.name AS subcategory_name,\n      s.image_url AS subcategory_image\n    FROM categories c\n    LEFT JOIN subcollections sc\n      ON sc.category_slug = c.slug\n    LEFT JOIN subcategories s\n      ON s.subcollection_id = sc.id\n    WHERE c.slug = $1\n    ORDER BY sc.name, s.name\n    `,\n    [urlDecoded]\n  );\n\n  if (rows.length === 0) return notFound();\n\n  console.log(rows);\n\n  // Group subcollections + subcategories\n  const subcollectionsMap: Record<string, any> = {};\n  rows.forEach((row) => {\n    if (!subcollectionsMap[row.subcollection_id]) {\n      subcollectionsMap[row.subcollection_id] = {\n        id: row.subcollection_id,\n        name: row.subcollection_name,\n        subcategories: [],\n      };\n    }\n    if (row.subcategory_slug) {\n      subcollectionsMap[row.subcollection_id].subcategories.push({\n        slug: row.subcategory_slug,\n        name: row.subcategory_name,\n        image_url: row.subcategory_image,\n      });\n    }\n  });\n\n  const subcollections = Object.values(subcollectionsMap);\n\n  // Get total product count\n  const finalCountRes = await getCategoryProductCount(urlDecoded);\n  const finalCount = finalCountRes ?? 0;\n\n  return (\n    <div className=\"container p-4\">\n      <h1 className=\"mb-4 border-b-2 text-sm font-bold\">\n        {finalCount} {finalCount === 1 ? \"Product\" : \"Products\"}\n      </h1>\n\n      {subcollections.length > 0 ? (\n        <div className=\"space-y-4\">\n          {subcollections.map((subcollection) => (\n            <div key={subcollection.id}>\n              <h2 className=\"mb-2 border-b-2 text-lg font-semibold\">\n                {subcollection.name}\n              </h2>\n              <div className=\"flex flex-row flex-wrap gap-2\">\n                {subcollection.subcategories.length > 0 ? (\n                  subcollection.subcategories.map((subcategory) => (\n                    <Link\n                      prefetch\n                      key={subcategory.slug}\n                      className=\"group flex h-full w-full flex-row gap-2 border px-4 py-2 hover:bg-gray-100 sm:w-[200px]\"\n                      href={`/products/${category}/${subcategory.slug}`}\n                    >\n                      <div className=\"py-2\">\n                        <Image\n                          loading=\"eager\"\n                          decoding=\"sync\"\n                          src={subcategory.image_url ?? \"/placeholder.svg\"}\n                          alt={`A small picture of ${subcategory.name}`}\n                          width={48}\n                          height={48}\n                          quality={65}\n                          className=\"h-12 w-12 flex-shrink-0 object-cover\"\n                        />\n                      </div>\n                      <div className=\"flex h-16 flex-grow flex-col items-start py-2\">\n                        <div className=\"text-sm font-medium text-gray-700 group-hover:underline\">\n                          {subcategory.name}\n                        </div>\n                      </div>\n                    </Link>\n                  ))\n                ) : (\n                  <div>No subcategories found.</div>\n                )}\n              </div>\n            </div>\n          ))}\n        </div>\n      ) : (\n        <div>No subcollections found.</div>\n      )}\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;;AAAA;AACA;AACA;AAAA;AACA;AACA;;;;;;;;;;;;AAEe,eAAe,KAAK,KAAuC;IACxE,MAAM,EAAE,QAAQ,EAAE,GAAG,MAAM,MAAM,MAAM;IACvC,MAAM,aAAa,mBAAmB;IAEtC,kDAAkD;IAClD,MAAM,EAAE,IAAI,EAAE,GAAG,MAAM,6HAAI,CAAC,KAAK,CAC/B,CAAC;;;;;;;;;;;;;;;;IAgBD,CAAC,EACD;QAAC;KAAW;IAGd,IAAI,KAAK,MAAM,KAAK,GAAG,OAAO,IAAA,iMAAQ;IAEtC,QAAQ,GAAG,CAAC;IAEZ,uCAAuC;IACvC,MAAM,oBAAyC,CAAC;IAChD,KAAK,OAAO,CAAC,CAAC;QACZ,IAAI,CAAC,iBAAiB,CAAC,IAAI,gBAAgB,CAAC,EAAE;YAC5C,iBAAiB,CAAC,IAAI,gBAAgB,CAAC,GAAG;gBACxC,IAAI,IAAI,gBAAgB;gBACxB,MAAM,IAAI,kBAAkB;gBAC5B,eAAe,EAAE;YACnB;QACF;QACA,IAAI,IAAI,gBAAgB,EAAE;YACxB,iBAAiB,CAAC,IAAI,gBAAgB,CAAC,CAAC,aAAa,CAAC,IAAI,CAAC;gBACzD,MAAM,IAAI,gBAAgB;gBAC1B,MAAM,IAAI,gBAAgB;gBAC1B,WAAW,IAAI,iBAAiB;YAClC;QACF;IACF;IAEA,MAAM,iBAAiB,OAAO,MAAM,CAAC;IAErC,0BAA0B;IAC1B,MAAM,gBAAgB,MAAM,IAAA,gJAAuB,EAAC;IACpD,MAAM,aAAa,iBAAiB;IAEpC,qBACE,8OAAC;QAAI,WAAU;;0BACb,8OAAC;gBAAG,WAAU;;oBACX;oBAAW;oBAAE,eAAe,IAAI,YAAY;;;;;;;YAG9C,eAAe,MAAM,GAAG,kBACvB,8OAAC;gBAAI,WAAU;0BACZ,eAAe,GAAG,CAAC,CAAC,8BACnB,8OAAC;;0CACC,8OAAC;gCAAG,WAAU;0CACX,cAAc,IAAI;;;;;;0CAErB,8OAAC;gCAAI,WAAU;0CACZ,cAAc,aAAa,CAAC,MAAM,GAAG,IACpC,cAAc,aAAa,CAAC,GAAG,CAAC,CAAC,4BAC/B,8OAAC,wIAAI;wCACH,QAAQ;wCAER,WAAU;wCACV,MAAM,CAAC,UAAU,EAAE,SAAS,CAAC,EAAE,YAAY,IAAI,EAAE;;0DAEjD,8OAAC;gDAAI,WAAU;0DACb,cAAA,8OAAC,wIAAK;oDACJ,SAAQ;oDACR,UAAS;oDACT,KAAK,YAAY,SAAS,IAAI;oDAC9B,KAAK,CAAC,mBAAmB,EAAE,YAAY,IAAI,EAAE;oDAC7C,OAAO;oDACP,QAAQ;oDACR,SAAS;oDACT,WAAU;;;;;;;;;;;0DAGd,8OAAC;gDAAI,WAAU;0DACb,cAAA,8OAAC;oDAAI,WAAU;8DACZ,YAAY,IAAI;;;;;;;;;;;;uCAlBhB,YAAY,IAAI;;;;8DAwBzB,8OAAC;8CAAI;;;;;;;;;;;;uBAjCD,cAAc,EAAE;;;;;;;;;qCAwC9B,8OAAC;0BAAI;;;;;;;;;;;;AAIb"}}]
}