{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///home/ayan/Programming/NextFasterPostgres/src/lib/middleware.ts"],"sourcesContent":["/* eslint-disable @typescript-eslint/no-explicit-any */\nimport { z } from \"zod\";\n\nexport type ActionState = {\n  error?: string;\n  success?: string;\n  [key: string]: any; // This allows for additional properties\n};\n\ntype ValidatedActionFunction<S extends z.ZodType<any, any>, T> = (\n  data: z.infer<S>,\n  formData: FormData,\n) => Promise<T>;\n\nexport function validatedAction<S extends z.ZodType<any, any>, T>(\n  schema: S,\n  action: ValidatedActionFunction<S, T>,\n) {\n  return async (prevState: ActionState, formData: FormData): Promise<T> => {\n    const result = schema.safeParse(Object.fromEntries(formData));\n    if (!result.success) {\n      return { error: result.error.errors[0].message } as T;\n    }\n\n    return action(result.data, formData);\n  };\n}\n"],"names":[],"mappings":"AAAA,qDAAqD;;;;AAc9C,SAAS,gBACd,MAAS,EACT,MAAqC;IAErC,OAAO,OAAO,WAAwB;QACpC,MAAM,SAAS,OAAO,SAAS,CAAC,OAAO,WAAW,CAAC;QACnD,IAAI,CAAC,OAAO,OAAO,EAAE;YACnB,OAAO;gBAAE,OAAO,OAAO,KAAK,CAAC,MAAM,CAAC,EAAE,CAAC,OAAO;YAAC;QACjD;QAEA,OAAO,OAAO,OAAO,IAAI,EAAE;IAC7B;AACF"}},
    {"offset": {"line": 23, "column": 0}, "map": {"version":3,"sources":["file:///home/ayan/Programming/NextFasterPostgres/src/lib/rate-limit.ts"],"sourcesContent":["import { Ratelimit } from \"@upstash/ratelimit\"; // for deno: see above\nimport { Redis } from \"@upstash/redis\"; // see below for cloudflare and fastly adapters\n\nconst isDev = process.env.NODE_ENV === \"development\";\n\nlet redis: Redis | null = null;\n\nif (!isDev) {\n  if (!process.env.KV_REST_API_URL || !process.env.KV_REST_API_TOKEN) {\n    throw new Error(\n      \"Please link a Vercel KV instance or populate `KV_REST_API_URL` and `KV_REST_API_TOKEN`\",\n    );\n  }\n\n  redis = new Redis({\n    url: process.env.KV_REST_API_URL,\n    token: process.env.KV_REST_API_TOKEN,\n  });\n}\n\n// Export dummy rate limiters in development\nexport const authRateLimit = isDev\n  ? { limit: async () => ({ success: true }) }\n  : new Ratelimit({\n      redis: redis!,\n      limiter: Ratelimit.slidingWindow(5, \"15 m\"),\n      analytics: true,\n      prefix: \"ratelimit:auth\",\n    });\n\nexport const signUpRateLimit = isDev\n  ? { limit: async () => ({ success: true }) }\n  : new Ratelimit({\n      redis: redis!,\n      limiter: Ratelimit.slidingWindow(1, \"15 m\"),\n      analytics: true,\n      prefix: \"ratelimit:signup\",\n    });\n"],"names":[],"mappings":";;;;;;AAAA,yQAAgD,sBAAsB;AACtE,iRAAwC,+CAA+C;;;AAEvF,MAAM,QAAQ,oDAAyB;AAEvC,IAAI,QAAsB;AAE1B;;AAcO,MAAM,gBAAgB,uCACzB;IAAE,OAAO,UAAY,CAAC;YAAE,SAAS;QAAK,CAAC;AAAE,IACzC;AAOG,MAAM,kBAAkB,uCAC3B;IAAE,OAAO,UAAY,CAAC;YAAE,SAAS;QAAK,CAAC;AAAE,IACzC"}},
    {"offset": {"line": 53, "column": 0}, "map": {"version":3,"sources":["file:///home/ayan/Programming/NextFasterPostgres/src/app/%28login%29/actions.ts"],"sourcesContent":["\"use server\";\n\nimport { z } from \"zod\";\nimport { eq } from \"drizzle-orm\";\nimport { cookies, headers } from \"next/headers\";\nimport { validatedAction } from \"@/lib/middleware\";\nimport pool from \"../../db/index.ts\";\n// import { NewUser, users } from \"@/db/schema\";\nimport { comparePasswords, hashPassword, setSession } from \"@/lib/session\";\nimport { authRateLimit, signUpRateLimit } from \"@/lib/rate-limit\";\n\nconst authSchema = z.object({\n  username: z.string().min(1),\n  password: z.string().min(1),\n});\n\nexport const signUp = validatedAction(authSchema, async (data) => {\n  const { username, password } = data;\n  const ip = (await headers()).get(\"x-real-ip\") ?? \"local\";\n  const rl2 = await signUpRateLimit.limit(ip);\n  if (!rl2.success) {\n    return {\n      error: {\n        code: \"AUTH_ERROR\",\n        message: \"Too many signups. Try again later\",\n      },\n    };\n  }\n\n  const existingUser = await pool.query('SELECT * FROM users WHERE username = $1', [username]);\n\n  if (existingUser.rows.length > 0) {\n    return { error: \"Username already taken. Please try again.\" };\n  }\n\n  const passwordHash = await hashPassword(password);\n\n  const newUser: NewUser = {\n    username,\n    passwordHash,\n  };\n\n  const createdUser = await pool.query('INSERT INTO users(username, password_hash) VALUES($1, $2) RETURNING *', [username, passwordHash]);\n\n  if (!createdUser) {\n    return { error: \"Failed to create user. Please try again.\" };\n  }\n  await setSession(createdUser.rows[0]);\n});\n\nexport const signIn = validatedAction(authSchema, async (data) => {\n  const { username, password } = data;\n  const ip = (await headers()).get(\"x-real-ip\") ?? \"local\";\n  const rl = await authRateLimit.limit(ip);\n\n  if (!rl.success) {\n    return {\n      error: {\n        code: \"AUTH_ERROR\",\n        message: \"Too many attempts. Try again later\",\n      },\n    };\n  }\n  \n  const user = await pool.query('SELECT * FROM users WHERE username = $1', [username]);\n\n  if (user.rows.length === 0) {\n    return { error: \"Invalid username or password. Please try again.\" };\n  }\n\n  console.log(user.rows[0]);\n\n  const foundUser = user.rows[0];\n\n  const isPasswordValid = await comparePasswords(\n    password,\n    foundUser.password_hash,\n  );\n\n  if (!isPasswordValid) {\n    return { error: \"Invalid username or password. Please try again.\" };\n  }\n  await setSession(foundUser);\n});\n\nexport async function signOut() {\n  // clear session & cart\n  const c = await cookies();\n  c.getAll().forEach((cookie) => c.delete(cookie.name));\n}\n"],"names":[],"mappings":";;;;;;;;;AAEA;AAEA;AACA;AACA;AACA,gDAAgD;AAChD;AACA;;;;;;;;;;;;;AAEA,MAAM,aAAa,uKAAC,CAAC,MAAM,CAAC;IAC1B,UAAU,uKAAC,CAAC,MAAM,GAAG,GAAG,CAAC;IACzB,UAAU,uKAAC,CAAC,MAAM,GAAG,GAAG,CAAC;AAC3B;AAEO,MAAM,SAAS,IAAA,2IAAe,EAAC,YAAY,OAAO;IACvD,MAAM,EAAE,QAAQ,EAAE,QAAQ,EAAE,GAAG;IAC/B,MAAM,KAAK,CAAC,MAAM,IAAA,0IAAO,GAAE,EAAE,GAAG,CAAC,gBAAgB;IACjD,MAAM,MAAM,MAAM,8IAAe,CAAC,KAAK,CAAC;IACxC,IAAI,CAAC,IAAI,OAAO,EAAE;QAChB,OAAO;YACL,OAAO;gBACL,MAAM;gBACN,SAAS;YACX;QACF;IACF;IAEA,MAAM,eAAe,MAAM,6HAAI,CAAC,KAAK,CAAC,2CAA2C;QAAC;KAAS;IAE3F,IAAI,aAAa,IAAI,CAAC,MAAM,GAAG,GAAG;QAChC,OAAO;YAAE,OAAO;QAA4C;IAC9D;IAEA,MAAM,eAAe,MAAM,IAAA,qIAAY,EAAC;IAExC,MAAM,UAAmB;QACvB;QACA;IACF;IAEA,MAAM,cAAc,MAAM,6HAAI,CAAC,KAAK,CAAC,yEAAyE;QAAC;QAAU;KAAa;IAEtI,IAAI,CAAC,aAAa;QAChB,OAAO;YAAE,OAAO;QAA2C;IAC7D;IACA,MAAM,IAAA,mIAAU,EAAC,YAAY,IAAI,CAAC,EAAE;AACtC;AAEO,MAAM,SAAS,IAAA,2IAAe,EAAC,YAAY,OAAO;IACvD,MAAM,EAAE,QAAQ,EAAE,QAAQ,EAAE,GAAG;IAC/B,MAAM,KAAK,CAAC,MAAM,IAAA,0IAAO,GAAE,EAAE,GAAG,CAAC,gBAAgB;IACjD,MAAM,KAAK,MAAM,4IAAa,CAAC,KAAK,CAAC;IAErC,IAAI,CAAC,GAAG,OAAO,EAAE;QACf,OAAO;YACL,OAAO;gBACL,MAAM;gBACN,SAAS;YACX;QACF;IACF;IAEA,MAAM,OAAO,MAAM,6HAAI,CAAC,KAAK,CAAC,2CAA2C;QAAC;KAAS;IAEnF,IAAI,KAAK,IAAI,CAAC,MAAM,KAAK,GAAG;QAC1B,OAAO;YAAE,OAAO;QAAkD;IACpE;IAEA,QAAQ,GAAG,CAAC,KAAK,IAAI,CAAC,EAAE;IAExB,MAAM,YAAY,KAAK,IAAI,CAAC,EAAE;IAE9B,MAAM,kBAAkB,MAAM,IAAA,yIAAgB,EAC5C,UACA,UAAU,aAAa;IAGzB,IAAI,CAAC,iBAAiB;QACpB,OAAO;YAAE,OAAO;QAAkD;IACpE;IACA,MAAM,IAAA,mIAAU,EAAC;AACnB;AAEO,eAAe;IACpB,uBAAuB;IACvB,MAAM,IAAI,MAAM,IAAA,0IAAO;IACvB,EAAE,MAAM,GAAG,OAAO,CAAC,CAAC,SAAW,EAAE,MAAM,CAAC,OAAO,IAAI;AACrD;;;IAzEa;IAkCA;IAmCS;;AArET,+OAAA;AAkCA,+OAAA;AAmCS,+OAAA"}},
    {"offset": {"line": 172, "column": 0}, "map": {"version":3,"sources":["file:///home/ayan/Programming/NextFasterPostgres/.next-internal/server/app/%28category-sidebar%29/products/%5Bcategory%5D/%5Bsubcategory%5D/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["export {signIn as '7fe0236c19040acada56656ef9a2c2fe08c9ebadd8'} from 'ACTIONS_MODULE0'\nexport {signUp as '7fcbb051050b63ee338eca26652ccec9995343e580'} from 'ACTIONS_MODULE0'\nexport {signOut as '00a97498f7dcf829ae064eb36ce42ff17088bd2d1e'} from 'ACTIONS_MODULE0'\n"],"names":[],"mappings":";AAAA"}}]
}